<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSH Cemara Management System (Fixed)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Config & Styles -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        cemara: { 50: '#f2fcf5', 100: '#e1f8e8', 500: '#22c55e', 700: '#15803d', 800: '#166534', 900: '#14532d' }
                    }
                }
            }
        }
    </script>
    <style>
        body { height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        
        /* Sticky Header */
        .sticky-header { background: rgba(255,255,255,0.95); backdrop-filter: blur(5px); z-index: 40; border-bottom: 1px solid #e5e7eb; }
        
        /* Spreadsheet Input Styles */
        .sheet-input { width: 100%; height: 100%; border: none; background: transparent; padding: 8px; outline: none; font-size: 0.875rem; }
        .sheet-input:focus { background: #f0fdf4; box-shadow: inset 0 0 0 2px #16a34a; }
        .sheet-readonly { background: #f9fafb; color: #6b7280; cursor: not-allowed; }
        .sheet-table th { background-color: #f3f4f6; color: #374151; font-size: 0.75rem; text-transform: uppercase; padding: 10px; border: 1px solid #e5e7eb; font-weight: 700; }
        .sheet-table td { border: 1px solid #e5e7eb; padding: 0; vertical-align: middle; height: 40px; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">

    <!-- LOGIN MODAL -->
    <div id="modal-login" class="fixed inset-0 z-[60] bg-cemara-900 bg-opacity-95 flex items-center justify-center fade-in">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md text-center border-t-8 border-cemara-500">
            <div class="mb-4 inline-block p-4 rounded-full bg-cemara-100 text-cemara-700"><i class="fa-solid fa-user-doctor text-4xl"></i></div>
            <h2 class="text-2xl font-bold mb-2">Login Petugas</h2>
            <p class="text-gray-500 mb-6 text-sm">Masukkan nama Anda untuk Audit Trail.</p>
            <form onsubmit="handleLogin(event)">
                <input type="text" id="loginName" class="w-full px-4 py-3 border rounded-xl text-center font-bold text-lg mb-4 focus:ring-2 focus:ring-cemara-500 outline-none" placeholder="Contoh: Drh. Budi / Paramedis Siti" required>
                <button type="submit" class="w-full bg-cemara-700 text-white font-bold py-3 rounded-xl hover:bg-cemara-800 transition-all">Masuk Sistem</button>
            </form>
        </div>
    </div>

    <!-- NAVBAR -->
    <nav class="bg-white border-b h-16 flex-none z-50">
        <div class="max-w-7xl mx-auto px-4 h-full flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer" onclick="showDashboard()">
                <div class="h-9 w-9 bg-cemara-700 rounded text-white flex items-center justify-center"><i class="fa-solid fa-hospital"></i></div>
                <div><h1 class="font-bold text-lg text-cemara-900 leading-tight">RSH CEMARA</h1><p class="text-[10px] text-gray-500 font-medium">MANAGEMENT SYSTEM v2.1 (Fixed)</p></div>
            </div>
            <div class="flex items-center gap-4">
                <button onclick="showMasterData()" class="text-sm font-bold text-gray-600 hover:text-cemara-700 mr-4"><i class="fa-solid fa-tags mr-1"></i> Master Harga</button>
                <div class="text-right hidden sm:block"><p class="text-xs text-gray-500">Petugas:</p><p id="displayUser" class="text-sm font-bold text-cemara-700">-</p></div>
                <button onclick="logout()" class="p-2 text-gray-400 hover:text-red-500" title="Logout"><i class="fa-solid fa-power-off"></i></button>
            </div>
        </div>
    </nav>

    <!-- CONTENT -->
    <div class="flex-grow overflow-y-auto" id="main-container">
        
        <!-- VIEW 1: DASHBOARD -->
        <div id="view-dashboard" class="max-w-7xl mx-auto p-6 fade-in space-y-6">
            <!-- Search & Register Bar -->
            <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-6">
                    <h2 class="text-2xl font-bold text-gray-800"><i class="fa-solid fa-paw text-cemara-600 mr-2"></i>Dashboard Pasien</h2>
                    <div class="relative w-full md:w-96">
                        <input type="text" id="searchPatient" onkeyup="renderPatientTable()" placeholder="Cari Pasien (Nama/RM)..." class="w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-cemara-500 outline-none">
                        <i class="fa-solid fa-magnifying-glass absolute left-3 top-3 text-gray-400"></i>
                    </div>
                </div>
                <!-- Toggle Form Register -->
                <div class="border rounded-xl overflow-hidden">
                    <button onclick="toggleRegForm()" class="w-full bg-gray-50 p-4 flex justify-between items-center hover:bg-gray-100 font-bold text-cemara-800">
                        <span><i class="fa-solid fa-plus-circle mr-2"></i>Daftar Pasien Baru</span>
                        <i class="fa-solid fa-chevron-down"></i>
                    </button>
                    <div id="form-reg-container" class="hidden p-6 bg-white">
                        <form onsubmit="registerPatient(event)">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <div class="space-y-3">
                                    <h4 class="font-bold text-gray-500 border-b pb-2 text-sm uppercase">A. Data Pemilik</h4>
                                    <div><label class="text-xs font-bold text-gray-600">Nama Lengkap</label><input type="text" id="regOwnerName" required class="w-full border rounded p-2"></div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <div><label class="text-xs font-bold text-gray-600">No. HP/WA</label><input type="tel" id="regPhone" required class="w-full border rounded p-2"></div>
                                        <div><label class="text-xs font-bold text-gray-600">Email</label><input type="email" id="regEmail" class="w-full border rounded p-2"></div>
                                    </div>
                                    <div><label class="text-xs font-bold text-gray-600">Alamat Rumah</label><textarea id="regAddress" class="w-full border rounded p-2" rows="2"></textarea></div>
                                </div>
                                <div class="space-y-3">
                                    <h4 class="font-bold text-gray-500 border-b pb-2 text-sm uppercase">B. Data Pasien</h4>
                                    <div class="grid grid-cols-2 gap-2">
                                        <div><label class="text-xs font-bold text-gray-600">Nama Hewan</label><input type="text" id="regPetName" required class="w-full border rounded p-2"></div>
                                        <div><label class="text-xs font-bold text-gray-600">Spesies</label><select id="regSpecies" required class="w-full border rounded p-2 bg-white"><option value="Anjing">Anjing</option><option value="Kucing">Kucing</option><option value="Kelinci">Kelinci</option><option value="Marmut">Marmut</option><option value="Burung">Burung</option></select></div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <div><label class="text-xs font-bold text-gray-600">Ras (Breed)</label><input type="text" id="regBreed" class="w-full border rounded p-2"></div>
                                        <div><label class="text-xs font-bold text-gray-600">Warna</label><input type="text" id="regColor" class="w-full border rounded p-2"></div>
                                    </div>
                                    <div class="grid grid-cols-3 gap-2">
                                        <div><label class="text-xs font-bold text-gray-600">Kelamin</label><select id="regSex" class="w-full border rounded p-2 bg-white"><option>Jantan</option><option>Betina</option></select></div>
                                        <div><label class="text-xs font-bold text-gray-600">Usia</label><input type="text" id="regAge" class="w-full border rounded p-2"></div>
                                        <div><label class="text-xs font-bold text-gray-600">Berat (kg)</label><input type="number" step="0.1" id="regWeight" required class="w-full border rounded p-2"></div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <div><label class="text-xs font-bold text-gray-600">Vaksinasi</label><input type="text" id="regVaccine" class="w-full border rounded p-2"></div>
                                        <div><label class="text-xs font-bold text-gray-600">Obat Cacing</label><input type="text" id="regDeworm" class="w-full border rounded p-2"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-6 text-right"><button type="submit" class="bg-cemara-700 text-white font-bold py-2 px-6 rounded-lg hover:bg-cemara-800 shadow">Simpan & Buka Medis</button></div>
                        </form>
                    </div>
                </div>
            </div>
            <!-- Patient List -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-gray-50 border-b text-gray-600 text-xs uppercase"><tr><th class="p-4">No. RM</th><th class="p-4">Pasien</th><th class="p-4">Pemilik</th><th class="p-4">Status</th><th class="p-4 text-right">Aksi</th></tr></thead>
                    <tbody id="patientTableBody" class="divide-y text-sm"></tbody>
                </table>
            </div>
        </div>

        <!-- VIEW 2: MASTER HARGA -->
        <div id="view-master" class="hidden max-w-7xl mx-auto p-6 fade-in">
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800"><i class="fa-solid fa-tags text-cemara-600 mr-2"></i>Master Data & Harga</h2>
                    <button onclick="showDashboard()" class="text-gray-500 hover:text-gray-700"><i class="fa-solid fa-times text-xl"></i></button>
                </div>
                <p class="text-sm text-gray-500 mb-4">Kelola harga Jasa, Obat, Lab, dan BHP untuk keperluan Billing.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                    <button onclick="renderMasterTable('jasa')" class="bg-blue-50 text-blue-700 p-3 rounded-lg font-bold hover:bg-blue-100 border border-blue-200">Jasa & Operasi</button>
                    <button onclick="renderMasterTable('obat')" class="bg-green-50 text-green-700 p-3 rounded-lg font-bold hover:bg-green-100 border border-green-200">Obat & Infus</button>
                    <button onclick="renderMasterTable('lab')" class="bg-purple-50 text-purple-700 p-3 rounded-lg font-bold hover:bg-purple-100 border border-purple-200">Lab & Penunjang</button>
                    <button onclick="renderMasterTable('bhp')" class="bg-orange-50 text-orange-700 p-3 rounded-lg font-bold hover:bg-orange-100 border border-orange-200">BHP (Habis Pakai)</button>
                </div>

                <div class="bg-gray-50 p-4 rounded-lg border">
                    <h3 id="masterTitle" class="font-bold text-lg mb-3">Daftar Item</h3>
                    <div class="flex gap-2 mb-4">
                        <input type="text" id="newItemName" placeholder="Nama Item Baru" class="border p-2 rounded flex-grow text-sm focus:outline-none focus:ring-2 focus:ring-cemara-500">
                        <input type="number" id="newItemPrice" placeholder="Harga (Rp)" class="border p-2 rounded w-32 text-sm focus:outline-none focus:ring-2 focus:ring-cemara-500">
                        <button onclick="addMasterItem()" class="bg-cemara-500 hover:bg-cemara-700 text-white px-6 rounded-lg font-bold text-sm transition-colors shadow-sm">Tambah</button>
                    </div>
                    <table class="w-full text-left bg-white border rounded text-sm">
                        <thead class="bg-gray-100"><tr><th class="p-3 border">Nama Item</th><th class="p-3 border">Harga (Rp)</th><th class="p-3 border w-20">Aksi</th></tr></thead>
                        <tbody id="masterTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- VIEW 3: MEDICAL RECORD -->
        <div id="view-medical" class="hidden bg-white min-h-full pb-20 fade-in">
            <!-- Header -->
            <div class="sticky-header px-6 py-3">
                <div class="max-w-7xl mx-auto flex justify-between items-start">
                    <div class="flex items-center gap-4">
                        <button onclick="showDashboard()" class="text-gray-400 hover:text-cemara-700"><i class="fa-solid fa-arrow-left text-xl"></i></button>
                        <div class="h-12 w-12 bg-gray-200 rounded-full overflow-hidden border border-gray-300"><img src="https://placehold.co/100?text=Pet" class="w-full h-full object-cover"></div>
                        <div>
                            <h2 class="text-xl font-bold flex items-center gap-2">
                                <span id="headName">Nama</span> 
                                <span id="headSpecies" class="text-[10px] bg-gray-100 border px-1 rounded text-gray-500 uppercase">SPECIES</span>
                            </h2>
                            <div class="text-xs text-gray-500 flex gap-2">
                                <span id="headRM" class="font-mono font-bold text-cemara-700">RM-000</span> | <span id="headOwner">Pemilik</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <select id="patientStatusSelect" onchange="updatePatientStatus()" class="text-xs bg-white border border-gray-300 rounded p-1 font-bold text-cemara-800">
                            <option value="Rawat Inap">üè• Rawat Inap</option>
                            <option value="Rawat Sehat">‚ú® Rawat Sehat</option>
                            <option value="Telah Dipulangkan">üè† Telah Dipulangkan</option>
                        </select>
                    </div>
                </div>
                <!-- Tabs -->
                <div class="max-w-7xl mx-auto mt-4 flex border-b">
                    <button onclick="switchTab('pomr')" id="tab-pomr" class="flex-1 py-2 text-sm font-bold border-b-2 border-cemara-600 text-cemara-700">POMR (Rekam Medis)</button>
                    <button onclick="switchTab('maor')" id="tab-maor" class="flex-1 py-2 text-sm font-medium text-gray-500 hover:text-cemara-600">MAOR (Jadwal Obat)</button>
                    <button onclick="switchTab('billing')" id="tab-billing" class="flex-1 py-2 text-sm font-medium text-gray-500 hover:text-cemara-600">Billing & Kasir</button>
                </div>
            </div>

            <div class="max-w-7xl mx-auto p-6">
                <!-- IDENTITAS LENGKAP -->
                <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-5 text-sm text-gray-700 shadow-sm mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 divide-y md:divide-y-0 md:divide-x divide-yellow-200">
                        <div class="pb-2 md:pb-0">
                            <h4 class="font-bold text-yellow-800 mb-2 text-xs tracking-widest border-b border-yellow-200 pb-1">DATA PEMILIK</h4>
                            <div class="grid grid-cols-3 gap-1 mb-1"><span class="text-xs text-gray-500">Nama:</span><span id="dispOwnerName" class="col-span-2 font-bold">-</span></div>
                            <div class="grid grid-cols-3 gap-1 mb-1"><span class="text-xs text-gray-500">Kontak:</span><span id="dispOwnerContact" class="col-span-2">-</span></div>
                            <div class="grid grid-cols-3 gap-1"><span class="text-xs text-gray-500">Alamat:</span><span id="dispOwnerAddress" class="col-span-2 italic">-</span></div>
                        </div>
                        <div class="pt-2 md:pt-0 md:pl-8">
                            <h4 class="font-bold text-yellow-800 mb-2 text-xs tracking-widest border-b border-yellow-200 pb-1">DATA PASIEN</h4>
                            <div class="grid grid-cols-2 gap-x-4">
                                <div><span class="text-xs text-gray-500">Ras:</span> <span id="dispPetBreed">-</span></div>
                                <div><span class="text-xs text-gray-500">Warna:</span> <span id="dispPetColor">-</span></div>
                                <div><span class="text-xs text-gray-500">Sex:</span> <span id="dispPetSex">-</span></div>
                                <div><span class="text-xs text-gray-500">Usia:</span> <span id="dispPetAge">-</span></div>
                                <div class="col-span-2 mt-1">
                                    <span class="text-xs text-gray-500">Berat:</span> <span id="dispPetWeight" class="font-bold">-</span> | 
                                    <span class="text-xs text-gray-500">Riwayat:</span> <span id="dispPetVaccine" class="font-medium">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB 1: POMR -->
                <div id="content-pomr" class="space-y-6 fade-in">
                    <!-- History Control -->
                    <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg border">
                        <div class="flex items-center gap-3">
                            <label class="text-xs font-bold text-gray-600">Riwayat Pemeriksaan:</label>
                            <select id="soapHistorySelect" onchange="loadSoapByDate()" class="border rounded p-1 text-sm bg-white font-bold text-cemara-700"></select>
                        </div>
                        <button onclick="createNewSoap()" class="bg-blue-600 text-white px-3 py-1.5 rounded text-xs font-bold hover:bg-blue-700"><i class="fa-solid fa-plus mr-1"></i>Pemeriksaan Baru</button>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- S & O -->
                        <div class="lg:col-span-3 bg-white border rounded-xl p-4 shadow-sm space-y-4">
                            <div>
                                <div class="flex justify-between mb-1">
                                    <h3 class="font-bold text-gray-700 text-sm">S (Subjective)</h3>
                                    <div class="text-xs text-gray-500">Tgl Periksa: <input type="date" id="soapDate" class="border rounded px-1 text-xs"></div>
                                </div>
                                <textarea id="soapS" class="w-full border rounded p-2 text-sm" rows="2" placeholder="Keluhan..."></textarea>
                            </div>
                            <div class="border-t pt-2">
                                <div class="flex justify-between items-center mb-2">
                                    <h3 class="font-bold text-gray-700 text-sm">O (Objective) - Vital Signs</h3>
                                    <span class="text-[10px] text-gray-400">Validasi Spesies: <span id="valSpecies" class="font-bold text-cemara-700">-</span></span>
                                </div>
                                
                                <!-- VITAL SIGN INPUTS DENGAN ID YANG SESUAI DENGAN JS -->
                                <div class="grid grid-cols-2 md:grid-cols-5 gap-3 mb-4">
                                    <div>
                                        <label class="text-[10px] font-bold text-gray-500 uppercase">Suhu (¬∞C)</label>
                                        <input id="inTemp" type="number" step="0.1" placeholder="00.0" oninput="validate('temp')" class="w-full border p-2 rounded text-center text-sm font-bold transition-colors">
                                        <div id="msgTemp" class="text-[9px] mt-1 h-3 leading-tight"></div>
                                    </div>
                                    <div>
                                        <label class="text-[10px] font-bold text-gray-500 uppercase">HR (bpm)</label>
                                        <input id="inHR" type="number" placeholder="0" oninput="validate('hr')" class="w-full border p-2 rounded text-center text-sm font-bold transition-colors">
                                        <div id="msgHR" class="text-[9px] mt-1 h-3 leading-tight"></div>
                                    </div>
                                    <div>
                                        <label class="text-[10px] font-bold text-gray-500 uppercase">RR (rpm)</label>
                                        <input id="inRR" type="number" placeholder="0" oninput="validate('rr')" class="w-full border p-2 rounded text-center text-sm font-bold transition-colors">
                                        <div id="msgRR" class="text-[9px] mt-1 h-3 leading-tight"></div>
                                    </div>
                                    <div>
                                        <label class="text-[10px] font-bold text-gray-500 uppercase">CRT (detik)</label>
                                        <input id="inCRT" type="number" step="0.1" placeholder="< 2" oninput="validate('crt')" class="w-full border p-2 rounded text-center text-sm font-bold transition-colors">
                                        <div id="msgCRT" class="text-[9px] mt-1 h-3 leading-tight"></div>
                                    </div>
                                    <div>
                                        <label class="text-[10px] font-bold text-gray-500 uppercase">Mukosa</label>
                                        <select id="inMucosa" onchange="validate('mucosa')" class="w-full border p-2 rounded text-sm bg-white font-bold transition-colors">
                                            <option value="">Pilih...</option>
                                            <option value="Pink">Pink</option>
                                            <option value="Pucat">Pucat</option>
                                            <option value="Sianosis">Sianosis</option>
                                            <option value="Ikterik">Ikterik</option>
                                            <option value="Merah Bata">Merah Bata</option>
                                        </select>
                                        <div id="msgMucosa" class="text-[9px] mt-1 h-3 leading-tight"></div>
                                    </div>
                                </div>
                                
                                <!-- PEMERIKSAAN PENUNJANG -->
                                <div class="bg-purple-50 p-3 rounded border border-purple-100">
                                    <h4 class="text-xs font-bold text-purple-800 mb-2">Pemeriksaan Penunjang (Checklist & Masuk Billing)</h4>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-xs" id="labChecklist">
                                        <!-- Will be populated by JS based on Master Data 'lab' -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- A -->
                        <div class="lg:col-span-1 bg-white border rounded-xl p-4 shadow-sm">
                            <h3 class="font-bold text-gray-700 text-sm mb-2">A (Assessment)</h3>
                            <textarea id="soapA" class="w-full border rounded p-2 text-sm mb-2" rows="3" placeholder="Diagnosa..."></textarea>
                            <label class="text-xs font-bold block mb-1">Prognosa</label>
                            <select id="soapProg" class="w-full border rounded p-2 text-sm"><option>Fausta</option><option>Dubius</option><option>Infausta</option></select>
                        </div>

                        <!-- P -->
                        <div class="lg:col-span-2 bg-white border rounded-xl p-4 shadow-sm">
                            <h3 class="font-bold text-gray-700 text-sm mb-2">P (Plan & Treatment)</h3>
                            <textarea id="soapP" class="w-full border rounded p-2 text-sm mb-4" rows="3" placeholder="Rencana terapi..."></textarea>
                            <!-- Kirim ke MAOR -->
                            <div class="bg-blue-50 p-2 rounded border border-blue-100 flex gap-2 items-center">
                                <input type="text" id="orderDrug" class="border rounded p-1 text-xs flex-grow" placeholder="Nama Obat">
                                <input type="text" id="orderDose" class="border rounded p-1 text-xs w-20" placeholder="Dosis">
                                <input type="text" id="orderRoute" class="border rounded p-1 text-xs w-20" placeholder="Rute">
                                <input type="text" id="orderFreq" class="border rounded p-1 text-xs w-20" placeholder="Freq">
                                <button onclick="sendOrderToMAOR()" class="bg-blue-600 text-white px-3 py-1 rounded text-xs font-bold">Kirim MAOR</button>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <button onclick="saveSoapData()" class="bg-cemara-700 text-white px-6 py-2 rounded-lg font-bold shadow hover:bg-cemara-800"><i class="fa-solid fa-save mr-2"></i>Simpan SOAP</button>
                    </div>
                </div>

                <!-- TAB 2: MAOR -->
                <div id="content-maor" class="hidden fade-in space-y-4">
                    <div class="bg-white border rounded-xl shadow-sm overflow-hidden">
                        <div class="p-4 bg-gray-50 flex justify-between items-center border-b">
                            <h3 class="font-bold text-gray-700">Treatment Flowsheet</h3>
                            <button onclick="addMaorRow()" class="bg-green-600 text-white px-3 py-1.5 rounded text-xs font-bold"><i class="fa-solid fa-plus mr-1"></i>Baris Baru</button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left sheet-table border-collapse">
                                <thead class="bg-gray-100 text-xs text-gray-600 uppercase">
                                    <tr><th class="w-24 border p-2">Jam</th><th class="border p-2">Nama Obat / Tindakan</th><th class="w-20 border p-2">Dosis</th><th class="w-20 border p-2">Rute</th><th class="w-24 border p-2">Pelaksana</th><th class="w-32 border p-2">Verif Dokter</th><th class="w-10 border p-2"></th></tr>
                                </thead>
                                <tbody id="maorBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- TAB 3: BILLING (NEW) -->
                <div id="content-billing" class="hidden fade-in space-y-4">
                    <div class="bg-white border rounded-xl shadow-sm p-6">
                        <h3 class="font-bold text-xl text-gray-800 mb-4"><i class="fa-solid fa-file-invoice-dollar mr-2"></i>Billing & Kasir</h3>
                        
                        <!-- Add Item Manual -->
                        <div class="bg-gray-50 p-4 rounded-lg border mb-4">
                            <h4 class="font-bold text-sm mb-2">Tambah Item ke Tagihan</h4>
                            <div class="flex gap-2">
                                <select id="billCategory" onchange="updateBillItemSelect()" class="border p-2 rounded text-sm w-32 font-bold focus:outline-none focus:border-cemara-500">
                                    <option value="jasa">Jasa/Op</option><option value="obat">Obat</option><option value="lab">Lab</option><option value="bhp">BHP</option>
                                </select>
                                <select id="billItemSelect" class="border p-2 rounded text-sm flex-grow focus:outline-none focus:border-cemara-500"></select>
                                <input type="number" id="billQty" value="1" class="border p-2 rounded text-sm w-16 text-center focus:outline-none focus:border-cemara-500" placeholder="Qty">
                                <button onclick="addToBill()" class="bg-cemara-500 hover:bg-cemara-700 text-white px-4 rounded font-bold text-sm transition-colors shadow-sm"><i class="fa-solid fa-plus"></i></button>
                            </div>
                        </div>

                        <table class="w-full text-left border rounded text-sm mb-4">
                            <thead class="bg-gray-100">
                                <tr><th class="p-3 border">Kategori</th><th class="p-3 border">Nama Item</th><th class="p-3 border text-center">Qty</th><th class="p-3 border text-right">Harga Satuan</th><th class="p-3 border text-right">Subtotal</th><th class="p-3 border text-center"></th></tr>
                            </thead>
                            <tbody id="billingBody"></tbody>
                            <tfoot class="bg-gray-50 font-bold text-lg">
                                <tr><td colspan="4" class="p-3 text-right">TOTAL TAGIHAN:</td><td class="p-3 text-right text-cemara-700" id="billTotal">Rp 0</td><td></td></tr>
                            </tfoot>
                        </table>

                        <div class="text-right">
                            <button onclick="window.print()" class="bg-gray-600 text-white px-6 py-2 rounded font-bold mr-2"><i class="fa-solid fa-print mr-2"></i>Cetak</button>
                            <button onclick="finalizeBill()" class="bg-green-600 text-white px-6 py-2 rounded font-bold"><i class="fa-solid fa-check-circle mr-2"></i>Selesai & Pulangkan</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- LOGIC -->
    <script>
        // --- 1. DATA STATE ---
        let db = JSON.parse(localStorage.getItem('rsh_db_v6')) || []; // Changed to v6 to clear potential bad data
        let masterData = JSON.parse(localStorage.getItem('rsh_master_prices')) || {
            jasa: [{name:'Konsultasi',price:100000}, {name:'Kastrasi Kucing Jantan',price:350000}, {name:'Steril Kucing Betina',price:600000}],
            obat: [{name:'Inj. Ondansetron',price:25000}, {name:'Infus RL 500ml',price:35000}, {name:'Antibiotik (Amox)',price:15000}],
            lab: [{name:'Darah Lengkap (CBC)',price:120000}, {name:'Kimia Darah',price:350000}, {name:'X-Ray',price:250000}, {name:'Test Kit FPV (Panleuko)',price:175000}, {name:'Test Kit FIP',price:200000}, {name:'Elisa Rabies',price:500000}],
            bhp: [{name:'Underpad',price:5000}, {name:'Spuit 3cc',price:3000}, {name:'Kasa Steril',price:5000}]
        };
        let currentUser = "";
        let activePatientId = null;
        let activeSoapIndex = -1; 

        const ranges = {
            'Anjing': { t:[38.0,39.2], hr:[60,140], rr:[10,30] },
            'Kucing': { t:[37.8,39.7], hr:[140,220], rr:[16,40] },
            'Kelinci': { t:[38.0,40.0], hr:[150,330], rr:[30,60] },
            'Marmut': { t:[37.2,39.5], hr:[230,320], rr:[40,100] },
            'Burung': { t:[40.2,41.5], hr:[150,700], rr:[15,80] }
        };

        // --- 2. AUTH & INIT ---
        function handleLogin(e) {
            e.preventDefault();
            currentUser = document.getElementById('loginName').value;
            document.getElementById('displayUser').innerText = currentUser;
            document.getElementById('modal-login').classList.add('hidden');
            renderPatientTable();
        }
        function logout() { location.reload(); }
        function saveDB() { localStorage.setItem('rsh_db_v6', JSON.stringify(db)); }
        function saveMaster() { localStorage.setItem('rsh_master_prices', JSON.stringify(masterData)); }

        // --- 3. MASTER DATA LOGIC ---
        let activeMasterCat = 'jasa';
        function showMasterData() { 
            document.getElementById('view-dashboard').classList.add('hidden');
            document.getElementById('view-medical').classList.add('hidden');
            document.getElementById('view-master').classList.remove('hidden');
            renderMasterTable('jasa');
        }
        function renderMasterTable(cat) {
            activeMasterCat = cat;
            document.getElementById('masterTitle').innerText = "Daftar " + cat.toUpperCase();
            const tbody = document.getElementById('masterTableBody');
            tbody.innerHTML = '';
            masterData[cat].forEach((item, idx) => {
                tbody.innerHTML += `<tr><td class="p-2 border">${item.name}</td><td class="p-2 border">Rp ${item.price.toLocaleString()}</td><td class="p-2 border text-center"><button onclick="delMasterItem('${cat}',${idx})" class="text-red-500"><i class="fa-solid fa-trash"></i></button></td></tr>`;
            });
        }
        function addMasterItem() {
            const name = document.getElementById('newItemName').value;
            const price = parseInt(document.getElementById('newItemPrice').value);
            if(name && price) {
                masterData[activeMasterCat].push({name, price});
                saveMaster(); renderMasterTable(activeMasterCat);
                document.getElementById('newItemName').value = '';
                document.getElementById('newItemPrice').value = '';
            }
        }
        function delMasterItem(cat, idx) { masterData[cat].splice(idx, 1); saveMaster(); renderMasterTable(cat); }

        // --- 4. PATIENT MANAGEMENT ---
        function toggleRegForm() { document.getElementById('form-reg-container').classList.toggle('hidden'); }
        function registerPatient(e) {
            e.preventDefault();
            const newP = {
                id: Date.now(),
                rm: `RM-${new Date().getFullYear().toString().substr(-2)}${Math.floor(1000+Math.random()*9000)}`,
                status: "Rawat Inap",
                owner: {
                    name: document.getElementById('regOwnerName').value,
                    phone: document.getElementById('regPhone').value,
                    email: document.getElementById('regEmail').value,
                    address: document.getElementById('regAddress').value
                },
                pet: {
                    name: document.getElementById('regPetName').value,
                    species: document.getElementById('regSpecies').value,
                    breed: document.getElementById('regBreed').value,
                    color: document.getElementById('regColor').value,
                    sex: document.getElementById('regSex').value,
                    age: document.getElementById('regAge').value,
                    weight: document.getElementById('regWeight').value,
                    vaccine: document.getElementById('regVaccine').value,
                    deworm: document.getElementById('regDeworm').value
                },
                soapHistory: [],
                maor: [],
                billing: []
            };
            // Create initial SOAP entry
            newP.soapHistory.push({
                date: new Date().toISOString().split('T')[0],
                s: "", o: {t:"", hr:"", rr:"", crt:"", mm:"Pink"}, a: {dx:"", prog:"Fausta"}, p: "", labs: []
            });
            db.push(newP); saveDB();
            e.target.reset(); toggleRegForm(); openMedical(newP.id);
        }
        function renderPatientTable() {
            const term = document.getElementById('searchPatient').value.toLowerCase();
            const tbody = document.getElementById('patientTableBody');
            tbody.innerHTML = "";
            db.filter(p => p.pet.name.toLowerCase().includes(term) || p.rm.toLowerCase().includes(term)).forEach(p => {
                let badge = p.status === 'Rawat Inap' ? 'bg-red-100 text-red-800' : p.status === 'Rawat Sehat' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800';
                tbody.innerHTML += `<tr class="hover:bg-gray-50 border-b"><td class="p-4 font-bold text-cemara-700">${p.rm}</td><td class="p-4 font-bold">${p.pet.name} <span class="font-normal text-xs text-gray-500">(${p.pet.species})</span></td><td class="p-4">${p.owner.name}</td><td class="p-4"><span class="${badge} px-2 py-1 rounded text-xs font-bold">${p.status}</span></td><td class="p-4 text-right"><button onclick="openMedical(${p.id})" class="text-blue-600 font-bold hover:underline">Buka</button></td></tr>`;
            });
        }

        // --- 5. MEDICAL RECORD (CORE) ---
        function showDashboard() {
            document.getElementById('view-dashboard').classList.remove('hidden');
            document.getElementById('view-medical').classList.add('hidden');
            document.getElementById('view-master').classList.add('hidden');
            renderPatientTable();
        }
        function openMedical(id) {
            try {
                activePatientId = id;
                const p = db.find(x => x.id === id);
                if(!p) { alert("Data Pasien Corrupt/Hilang"); return; }
                
                // Render Header & Identity
                document.getElementById('headName').innerText = p.pet.name;
                document.getElementById('headSpecies').innerText = p.pet.species;
                document.getElementById('headRM').innerText = p.rm;
                document.getElementById('headOwner').innerText = p.owner.name;
                document.getElementById('patientStatusSelect').value = p.status;
                document.getElementById('valSpecies').innerText = p.pet.species;
                
                // Full Identity Card
                document.getElementById('dispOwnerName').innerText = p.owner.name;
                document.getElementById('dispOwnerContact').innerText = p.owner.phone;
                document.getElementById('dispOwnerAddress').innerText = p.owner.address;
                document.getElementById('dispPetBreed').innerText = p.pet.breed;
                document.getElementById('dispPetColor').innerText = p.pet.color;
                document.getElementById('dispPetSex').innerText = p.pet.sex;
                document.getElementById('dispPetAge').innerText = p.pet.age;
                document.getElementById('dispPetWeight').innerText = p.pet.weight + " kg";
                document.getElementById('dispPetVaccine').innerText = `Vaksin: ${p.pet.vaccine || '-'} | Cacing: ${p.pet.deworm || '-'}`;

                // Render Lab Checklist from Master Data
                const labDiv = document.getElementById('labChecklist');
                labDiv.innerHTML = '';
                masterData.lab.forEach(l => {
                    labDiv.innerHTML += `<label class="flex items-center gap-2"><input type="checkbox" value="${l.name}" class="lab-checkbox"> ${l.name}</label>`;
                });

                // Check for legacy data compatibility
                if (!p.soapHistory) p.soapHistory = [];
                if (p.soapHistory.length === 0) {
                    p.soapHistory.push({ date: new Date().toISOString().split('T')[0], s: "", o: {}, a: {}, p: "", labs: [] });
                }

                updateSoapHistoryDropdown();
                loadSoapByIndex(p.soapHistory.length - 1);

                document.getElementById('view-dashboard').classList.add('hidden');
                document.getElementById('view-medical').classList.remove('hidden');
                switchTab('pomr');
            } catch (e) {
                console.error(e);
                alert("Gagal membuka data: " + e.message);
            }
        }

        // --- 6. SOAP & MULTI-DATE LOGIC ---
        function updateSoapHistoryDropdown() {
            const p = db.find(x => x.id === activePatientId);
            const select = document.getElementById('soapHistorySelect');
            select.innerHTML = '';
            p.soapHistory.forEach((item, idx) => {
                const opt = document.createElement('option');
                opt.value = idx;
                opt.text = item.date + (idx === p.soapHistory.length - 1 ? " (Terbaru)" : "");
                select.appendChild(opt);
            });
            select.value = p.soapHistory.length - 1;
        }

        function loadSoapByDate() {
            const idx = parseInt(document.getElementById('soapHistorySelect').value);
            loadSoapByIndex(idx);
        }

        function loadSoapByIndex(idx) {
            activeSoapIndex = idx;
            const p = db.find(x => x.id === activePatientId);
            const soap = p.soapHistory[idx];

            document.getElementById('soapDate').value = soap.date || "";
            document.getElementById('soapS').value = soap.s || "";
            document.getElementById('inTemp').value = soap.o.t || "";
            document.getElementById('inHR').value = soap.o.hr || "";
            document.getElementById('inRR').value = soap.o.rr || "";
            document.getElementById('inCRT').value = soap.o.crt || "";
            document.getElementById('inMucosa').value = soap.o.mm || "Pink";
            document.getElementById('soapA').value = soap.a.dx || "";
            document.getElementById('soapProg').value = soap.a.prog || "Fausta";
            document.getElementById('soapP').value = soap.p || "";

            // Set checkboxes
            document.querySelectorAll('.lab-checkbox').forEach(cb => {
                cb.checked = soap.labs && soap.labs.includes(cb.value);
            });

            // TRIGGER VALIDATION VISUALS ON LOAD
            ['temp','hr','rr','crt','mucosa'].forEach(t => validate(t));
        }

        function createNewSoap() {
            const p = db.find(x => x.id === activePatientId);
            const today = new Date().toISOString().split('T')[0];
            
            const existingIdx = p.soapHistory.findIndex(h => h.date === today);
            if(existingIdx !== -1) {
                alert("Pemeriksaan untuk tanggal hari ini sudah ada.");
                document.getElementById('soapHistorySelect').value = existingIdx;
                loadSoapByIndex(existingIdx);
                return;
            }

            p.soapHistory.push({
                date: today,
                s: "", o: {t:"", hr:"", rr:"", crt:"", mm:"Pink"}, a: {dx:"", prog:"Fausta"}, p: "", labs: []
            });
            saveDB();
            updateSoapHistoryDropdown();
            loadSoapByIndex(p.soapHistory.length - 1);
        }

        function saveSoapData() {
            const p = db.find(x => x.id === activePatientId);
            const soap = p.soapHistory[activeSoapIndex];
            
            soap.date = document.getElementById('soapDate').value;
            soap.s = document.getElementById('soapS').value;
            soap.o.t = document.getElementById('inTemp').value;
            soap.o.hr = document.getElementById('inHR').value;
            soap.o.rr = document.getElementById('inRR').value;
            soap.o.crt = document.getElementById('inCRT').value;
            soap.o.mm = document.getElementById('inMucosa').value;
            soap.a.dx = document.getElementById('soapA').value;
            soap.a.prog = document.getElementById('soapProg').value;
            soap.p = document.getElementById('soapP').value;

            const selectedLabs = [];
            document.querySelectorAll('.lab-checkbox:checked').forEach(cb => {
                selectedLabs.push(cb.value);
                addLabToBilling(cb.value);
            });
            soap.labs = selectedLabs;

            saveDB();
            alert("Data SOAP Tersimpan!");
        }

        // --- 7. BILLING LOGIC ---
        function addLabToBilling(labName) {
            const p = db.find(x => x.id === activePatientId);
            const exists = p.billing.some(b => b.name === labName); 
            if(!exists) {
                const item = masterData.lab.find(l => l.name === labName);
                if(item) {
                    p.billing.push({category: 'lab', name: item.name, price: item.price, qty: 1});
                    saveDB();
                }
            }
        }

        function updateBillItemSelect() {
            const cat = document.getElementById('billCategory').value;
            const select = document.getElementById('billItemSelect');
            select.innerHTML = '';
            masterData[cat].forEach(item => {
                const opt = document.createElement('option');
                opt.value = item.name;
                opt.text = `${item.name} - Rp ${item.price.toLocaleString()}`;
                select.appendChild(opt);
            });
        }

        function addToBill() {
            const p = db.find(x => x.id === activePatientId);
            const cat = document.getElementById('billCategory').value;
            const name = document.getElementById('billItemSelect').value;
            const qty = parseInt(document.getElementById('billQty').value);
            
            const itemObj = masterData[cat].find(i => i.name === name);
            
            if(itemObj) {
                p.billing.push({category: cat, name: name, price: itemObj.price, qty: qty});
                saveDB();
                renderBilling();
            }
        }

        function renderBilling() {
            const p = db.find(x => x.id === activePatientId);
            const tbody = document.getElementById('billingBody');
            tbody.innerHTML = '';
            let total = 0;

            p.billing.forEach((item, idx) => {
                const subtotal = item.price * item.qty;
                total += subtotal;
                tbody.innerHTML += `
                    <tr class="border-b">
                        <td class="p-3 uppercase text-xs font-bold text-gray-500">${item.category}</td>
                        <td class="p-3">${item.name}</td>
                        <td class="p-3 text-center">${item.qty}</td>
                        <td class="p-3 text-right">Rp ${item.price.toLocaleString()}</td>
                        <td class="p-3 text-right font-bold">Rp ${subtotal.toLocaleString()}</td>
                        <td class="p-3 text-center"><button onclick="delBillItem(${idx})" class="text-red-500"><i class="fa-solid fa-trash"></i></button></td>
                    </tr>
                `;
            });
            document.getElementById('billTotal').innerText = "Rp " + total.toLocaleString();
        }

        function delBillItem(idx) {
            const p = db.find(x => x.id === activePatientId);
            p.billing.splice(idx, 1);
            saveDB(); renderBilling();
        }

        function finalizeBill() {
            if(confirm("Selesaikan tagihan dan ubah status pasien menjadi 'Pulang'?")) {
                const p = db.find(x => x.id === activePatientId);
                p.status = 'Telah Dipulangkan';
                document.getElementById('patientStatusSelect').value = 'Telah Dipulangkan';
                saveDB();
                alert("Status Pasien Updated.");
            }
        }

        // --- 8. MAOR SPREADSHEET ---
        function renderMaor() {
            const p = db.find(x => x.id === activePatientId);
            const tbody = document.getElementById('maorBody');
            tbody.innerHTML = "";
            p.maor.forEach((row, idx) => {
                const locked = row.verifiedBy !== null;
                const ro = locked ? "sheet-readonly" : "sheet-input";
                let action = locked ? `<div class="bg-green-100 text-green-800 text-xs p-2 rounded text-center font-bold">${row.verifiedBy}</div>` : `<button onclick="verifyRow(${idx})" class="w-full bg-blue-600 text-white text-xs py-1 rounded">Verifikasi</button>`;
                let del = locked ? "" : `<button onclick="delRow(${idx})" class="text-red-500"><i class="fa-solid fa-trash"></i></button>`;
                
                tbody.innerHTML += `<tr>
                    <td><input type="time" class="${ro}" value="${row.time}" onchange="updMaor(${idx},'time',this.value)" ${locked?'disabled':''}></td>
                    <td><input type="text" class="${ro}" value="${row.drug}" onchange="updMaor(${idx},'drug',this.value)" ${locked?'disabled':''}></td>
                    <td><input type="text" class="${ro}" value="${row.dose}" onchange="updMaor(${idx},'dose',this.value)" ${locked?'disabled':''}></td>
                    <td><input type="text" class="${ro}" value="${row.route}" onchange="updMaor(${idx},'route',this.value)" ${locked?'disabled':''}></td>
                    <td><input type="text" class="${ro}" value="${row.officer}" onchange="updMaor(${idx},'officer',this.value)" ${locked?'disabled':''}></td>
                    <td class="p-1">${action}</td><td class="p-1 text-center">${del}</td>
                </tr>`;
            });
        }
        function addMaorRow() {
            const p = db.find(x => x.id === activePatientId);
            p.maor.push({time: new Date().toTimeString().substr(0,5), drug:'', dose:'', route:'', officer:'', verifiedBy: null});
            saveDB(); renderMaor();
        }
        function updMaor(idx, key, val) { db.find(x=>x.id===activePatientId).maor[idx][key] = val; saveDB(); }
        function verifyRow(idx) {
            if(!currentUser) return alert("Login dulu!");
            const p = db.find(x => x.id === activePatientId);
            p.maor[idx].verifiedBy = currentUser;
            saveDB(); renderMaor();
        }
        function delRow(idx) { db.find(x=>x.id===activePatientId).maor.splice(idx,1); saveDB(); renderMaor(); }
        function sendOrderToMAOR() {
            const p = db.find(x => x.id === activePatientId);
            p.maor.push({
                time: new Date().toTimeString().substr(0,5),
                drug: document.getElementById('orderDrug').value,
                dose: document.getElementById('orderDose').value,
                route: document.getElementById('orderRoute').value,
                officer: "", verifiedBy: null
            });
            saveDB(); renderMaor(); alert("Terkirim ke MAOR");
        }

        // --- 9. TAB & VALIDATION HELPERS ---
        function switchTab(t) {
            ['pomr','maor','billing'].forEach(tab => {
                document.getElementById(`content-${tab}`).classList.add('hidden');
                document.getElementById(`tab-${tab}`).className = "flex-1 py-2 text-sm font-medium text-gray-500 hover:text-cemara-600";
            });
            document.getElementById(`content-${t}`).classList.remove('hidden');
            document.getElementById(`tab-${t}`).className = "flex-1 py-2 text-sm font-bold border-b-2 border-cemara-600 text-cemara-700";
            if(t === 'maor') renderMaor();
            if(t === 'billing') { updateBillItemSelect(); renderBilling(); }
        }

        function validate(type) {
            const p = db.find(x => x.id === activePatientId);
            if(!p) return;
            const species = p.pet.species || 'Kucing';
            const ref = ranges[species] || ranges['Kucing'];
            
            // Mapping ID Element Correctly to HTML
            let elId = 'inTemp', msgId = 'msgTemp';
            if(type === 'hr') { elId = 'inHR'; msgId = 'msgHR'; }
            if(type === 'rr') { elId = 'inRR'; msgId = 'msgRR'; }
            if(type === 'crt') { elId = 'inCRT'; msgId = 'msgCRT'; }
            if(type === 'mucosa') { elId = 'inMucosa'; msgId = 'msgMucosa'; }

            const el = document.getElementById(elId);
            const msgEl = document.getElementById(msgId);
            
            // Safety check
            if (!el || !msgEl) return;

            const val = el.value;
            
            // Reset Styles
            el.className = "w-full border p-2 rounded text-center text-sm font-bold transition-colors border-gray-300";
            msgEl.innerHTML = "";

            if(!val) return;

            let isAbnormal = false;
            let normalText = "";

            if(type === 'crt') {
                if(parseFloat(val) > 2) { isAbnormal = true; normalText = "< 2 detik"; }
            } else if (type === 'mucosa') {
                if(val !== 'Pink') { isAbnormal = true; normalText = "Harus Pink"; }
            } else {
                let r;
                if(type === 'temp') r = ref.t;
                if(type === 'hr') r = ref.hr;
                if(type === 'rr') r = ref.rr;
                
                const num = parseFloat(val);
                if(num < r[0] || num > r[1]) {
                    isAbnormal = true;
                    normalText = `${r[0]} - ${r[1]}`;
                }
            }

            if(isAbnormal) {
                el.classList.remove('border-gray-300');
                el.classList.add('border-red-500', 'bg-red-50', 'text-red-700');
                msgEl.innerHTML = `<span class="text-red-600 font-bold"><i class="fa-solid fa-triangle-exclamation"></i> Normal: ${normalText}</span>`;
            } else {
                el.classList.remove('border-gray-300');
                el.classList.add('border-green-500', 'bg-green-50', 'text-green-700');
                msgEl.innerHTML = `<span class="text-green-600 font-bold"><i class="fa-solid fa-check"></i> Normal</span>`;
            }
        }

        function updatePatientStatus() {
            const p = db.find(x=>x.id===activePatientId);
            p.status = document.getElementById('patientStatusSelect').value; saveDB();
        }

        // INIT
        renderPatientTable();
    </script>
</body>
</html>